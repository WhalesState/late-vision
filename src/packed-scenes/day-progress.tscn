[gd_scene load_steps=7 format=2]

[ext_resource path="res://assets/UI/day-progress-border.png" type="Texture" id=1]
[ext_resource path="res://assets/UI/day-progress.png" type="Texture" id=2]
[ext_resource path="res://src/packed-scenes/day-progress.gd" type="Script" id=3]

[sub_resource type="GDScript" id=11]

[sub_resource type="Shader" id=4]
code = "shader_type canvas_item;

uniform lowp int time: hint_range(1, 1440, 1) = 1;
uniform lowp float sun_rise: hint_range(1.0, 1440.0, 1.0) = 1.0;
uniform lowp float sun_rise_time: hint_range(1.0, 1440.0, 1.0) = 1.0;
uniform lowp float sun_set: hint_range(1.0, 1440.0, 1.0) = 1.0;
uniform lowp float sun_set_time: hint_range(1.0, 1440.0, 1.0) = 1.0;
uniform vec4 day_color: hint_color = vec4(0.99, 0.96, 0.63, 1.0);
uniform vec4 night_color: hint_color = vec4(0.05, 0.1, 0.15, 1.0);
uniform vec2 size = vec2(156, 36);



void fragment() {
	vec2 uv = vec2(UV.x + ((float(time) / 1440.0) + TIME * 0.1), UV.y);
	uv = ( ceil(uv * (size / 2.0)) / (size / 2.0) );
	while (uv.x > 1.0) {
		uv.x = uv.x - 1.0;
	}
	vec4 tex = texture(TEXTURE, uv);
	if (uv.x < (sun_rise / 1440.0)) {
		if (tex.r < 0.5) {
			COLOR = night_color;
		}
	} else if (uv.x < (sun_rise_time + sun_rise ) / 1440.0 ) {
		COLOR = mix(
			night_color,
			day_color,
			smoothstep( sun_rise / 1440.0, ( sun_rise_time + sun_rise ) / 1440.0, uv.x ) );
	} else if (uv.x < sun_set / 1440.0) {
		COLOR = day_color;
	} else if (uv.x < ( sun_set_time + sun_set ) / 1440.0 ) {
		COLOR = mix(
			day_color,
			night_color,
			smoothstep( sun_set / 1440.0, ( sun_set_time + sun_set ) / 1440.0, uv.x ) );
	} else {
		if (tex.r < 0.5) {
			COLOR = night_color;
		}
		
	}
	COLOR.a = tex.a;
}

"
script = SubResource( 11 )

[sub_resource type="ShaderMaterial" id=3]
shader = SubResource( 4 )
shader_param/time = 1
shader_param/sun_rise = 197.0
shader_param/sun_rise_time = 90.0
shader_param/sun_set = 941.0
shader_param/sun_set_time = 90.0
shader_param/day_color = Color( 1, 0.913725, 0.529412, 1 )
shader_param/night_color = Color( 0, 0.111167, 0.23, 1 )
shader_param/size = Vector2( 156, 36 )

[node name="DayProgress" type="NinePatchRect"]
anchor_right = 1.0
anchor_bottom = 1.0
margin_right = -804.0
margin_bottom = -604.0
rect_min_size = Vector2( 156, 36 )
texture = ExtResource( 1 )
patch_margin_left = 6
patch_margin_top = 12
patch_margin_right = 6
patch_margin_bottom = 12
script = ExtResource( 3 )
__meta__ = {
"_edit_use_anchors_": false
}

[node name="Margin" type="MarginContainer" parent="."]
show_behind_parent = true
anchor_right = 1.0
anchor_bottom = 1.0
size_flags_horizontal = 3
size_flags_vertical = 3
custom_constants/margin_right = 6
custom_constants/margin_top = 6
custom_constants/margin_left = 6
custom_constants/margin_bottom = 6
__meta__ = {
"_edit_lock_": true,
"_edit_use_anchors_": false
}

[node name="BG" type="TextureRect" parent="Margin"]
material = SubResource( 3 )
margin_left = 6.0
margin_top = 6.0
margin_right = 150.0
margin_bottom = 30.0
texture = ExtResource( 2 )
expand = true
flip_h = true
__meta__ = {
"_edit_use_anchors_": false
}
